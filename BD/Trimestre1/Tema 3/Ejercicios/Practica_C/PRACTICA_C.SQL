CREATE DATABASE TIENDA;
USE TIENDA;

DROP TABLE IF EXISTS FABRICANTES, ARTICULOS, TIENDAS, PEDIDOS, VENTAS;

CREATE TABLE FABRICANTES
(
	COD_FABRICANTE INT(3) PRIMARY KEY,
	NOMBRE VARCHAR(15),
	PAIS VARCHAR(15)
);

CREATE TABLE ARTICULOS
(
	ARTICULO VARCHAR(20) NOT NULL,
	COD_FABRICANTE INT(3) NOT NULL,
	PESO INT(3) NOT NULL,
	CATEGORIA VARCHAR(10) NOT NULL,
	PRECIO_VENTA INT(4),
	PRECIO_COSTO INT(4),
	EXISTENCIAS INT (5),
	CONSTRAINT PK_ARTICULOS PRIMARY KEY(ARTICULO, COD_FABRICANTE, PESO, CATEGORIA),
	CONSTRAINT FK_ARTICULOS_FABRICANTES FOREIGN KEY(COD_FABRICANTE)
		REFERENCES FABRICANTES(COD_FABRICANTE),
	CONSTRAINT CK_PRECIO_VENTA CHECK(PRECIO_VENTA > 0),
	CONSTRAINT CK_PRECIO_COSTO CHECK(PRECIO_COSTO > 0),
	CONSTRAINT CK_PESO CHECK(PESO > 0)
	
);

CREATE TABLE TIENDAS
(
	NIF VARCHAR(10) PRIMARY KEY,
	NOMBRE VARCHAR(20),
	DIRECCION VARCHAR(20),
	POBLACION VARCHAR(20),
	PROVINCIA VARCHAR(20),
	COD_POSTAL INT(5)
);

CREATE TABLE PEDIDOS
(
	NIF VARCHAR(10),
	ARTICULO VARCHAR(20),
	COD_FABRICANTE INT(3),
	PESO INT(3),
	CATEGORIA VARCHAR(10),
	FECHA_PEDIDO DATE,
	UNIDADES_PEDIDAS INT(4),
	CONSTRAINT PK_PEDIDOS PRIMARY KEY(NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA, FECHA_PEDIDO),
	CONSTRAINT FK_PEDIDOS_ARTICULOS FOREIGN KEY(ARTICULO, COD_FABRICANTE, PESO, CATEGORIA)
		REFERENCES ARTICULOS(ARTICULO, COD_FABRICANTE, PESO, CATEGORIA),
	CONSTRAINT FK_PEDIDOS_TIENDAS FOREIGN KEY(NIF)
		REFERENCES TIENDAS(NIF)
);

CREATE TABLE VENTAS
(
	NIF VARCHAR(10),
	ARTICULO VARCHAR(20),
	COD_FABRICANTE INT(3),
	PESO INT(3),
	CATEGORIA VARCHAR(10),
	FECHA_VENTA DATE,
	UNIDADES_VENDIDAS INT(4),
	CONSTRAINT PK_VENTAS PRIMARY KEY(NIF, ARTICULO, COD_FABRICANTE, PESO, CATEGORIA, FECHA_VENTA),
	CONSTRAINT CK_UNIDADES_VENDIDAS CHECK(UNIDADES_VENDIDAS > 0),
	CONSTRAINT FK_VENTAS_ARTICULOS FOREIGN KEY(ARTICULO, COD_FABRICANTE, PESO, CATEGORIA)
		REFERENCES ARTICULOS(ARTICULO, COD_FABRICANTE, PESO, CATEGORIA)
		ON DELETE CASCADE,
	CONSTRAINT FK_VENTAS_TIENDAS FOREIGN KEY(NIF)
		REFERENCES TIENDAS(NIF)
);